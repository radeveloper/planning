# 1) yeni token al
TOKEN=$(curl -s -X POST http://localhost:3000/api/v1/auth/guest \
  -H 'content-type: application/json' \
  -d '{"displayName":"Ekrem"}' | jq -r .accessToken)

# 2) yeni oda oluştur
ROOM=$(curl -s -X POST http://localhost:3000/api/v1/rooms \
  -H "authorization: Bearer $TOKEN" \
  -H 'content-type: application/json' \
  -d '{"name":"The Agile Architects","deckType":"fibonacci"}')

# 3) CODE ve owner PID’i çek
CODE=$(echo "$ROOM" | jq -r .code)
OWNER_PID=$(echo "$ROOM" | jq -r .participantId)

# 4) ikinci katılımcıyı ekle ve PID’ini al (isteğe bağlı)
JOIN=$(curl -s -X POST http://localhost:3000/api/v1/rooms/$CODE/join \
  -H "authorization: Bearer $TOKEN" \
  -H 'content-type: application/json' \
  -d '{"displayName":"Ada"}')
PID=$(echo "$JOIN" | jq -r .participantId)

# 5) boş mu?
echo "CODE=$CODE PID=$PID TOKEN_LEN=${#TOKEN}"
